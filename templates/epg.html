<section id="epgContainer" class="home-section epg-section">
  <div id="epg" class="container">
      <div id="tn1epg_table" class="table-section" style="display: none;">
          <table class="table table-bordered table-striped" border="1">
              <thead>
                  <tr>
                      <th>Date</th>
                      <th>Average gc-0/16/1</th>
                      <th>Peak gc-0/16/1</th>
                      <th>Average gc-0/4/1</th>
                      <th>Peak gc-0/4/1</th>
                      <th>Average gc-0/5/1</th>
                      <th>Peak gc-0/5/1</th>
                      <th>Average gc-0/14/1</th>
                      <th>Peak gc-0/14/1</th>
                      <th>Average gc-0/15/1</th>
                      <th>Peak gc-0/15/1</th>
                      <th>Average gc-0/17/1</th>
                      <th>Peak gc-0/17/1</th>
                      <th>Average gc-0/6/1</th>
                      <th>Peak gc-0/6/1</th>
                      <th>Active PDP context</th>
                      <th>Active EPS Bearers</th>
                      <th>Active Subscribers</th>
                      
                  </tr>
              </thead>
              <tbody>
                  {% for item in tn1epg_data %}
                  <tr>
                      <td>{{ item.date }}</td>
                      <td>{{ item.avg16 }}</td>
                      <td>{{ item.peak16 }}</td>
                      <td>{{ item.avg4 }}</td>
                      <td>{{ item.peak4 }}</td>
                      <td>{{ item.avg5 }}</td>
                      <td>{{ item.peak5 }}</td>
                      <td>{{ item.avg14 }}</td>
                      <td>{{ item.peak14 }}</td>
                      <td>{{ item.avg15 }}</td>
                      <td>{{ item.peak15 }}</td>
                      <td>{{ item.avg17 }}</td>
                      <td>{{ item.peak17 }}</td>
                      <td>{{ item.avg6 }}</td>
                      <td>{{ item.peak6 }}</td>
                      <td>{{ item.actpdpcont }}</td>
                      <td>{{ item.acteps }}</td>
                      <td>{{ item.actsub }}</td>

                  </tr>
                  {% endfor %}
              </tbody>
          </table>
      </div>

      <div id="tn2vepg_table" class="table-section" style="display: none;">
          <table class="table table-bordered table-striped" border="1">
              <thead>
                  <tr>
                      <th>Date</th>
                      <th>Average gc-0/29/1</th>
                      <th>Peak gc-0/29/1</th>
                      <th>Average gc-0/30/1</th>
                      <th>Peak gc-0/30/1</th>
                      <th>Average gc-0/1/1</th>
                      <th>Peak gc-0/1/1</th>
                      <th>Average gc-0/10/1</th>
                      <th>Peak gc-0/10/1</th>
                      <th>Average gc-0/11/1</th>
                      <th>Peak gc-0/11/1</th>
                      <th>Average gc-0/12/1</th>
                      <th>Peak gc-0/12/1</th>
                      <th>Average gc-0/2/1</th>
                      <th>Peak gc-0/2/1</th>
                      <th>Average gc-0/3/1</th>
                      <th>Peak gc-0/3/1</th>
                      <th>Average gc-0/4/1</th>
                      <th>Peak gc-0/4/1</th>
                      <th>Average gc-0/5/1</th>
                      <th>Peak gc-0/5/1</th>
                      <th>Average gc-0/6/1</th>
                      <th>Peak gc-0/6/1</th>
                      <th>Average gc-0/7/1</th>
                      <th>Peak gc-0/7/1</th>
                      <th>Average gc-0/8/1</th>
                      <th>Peak gc-0/8/1</th>
                      <th>Average gc-0/9/1</th>
                      <th>Peak gc-0/9/1</th>
                      <th>Active PDP context</th>
                      <th>Active EPS Bearers</th>
                      <th>Active Subscribers</th>
                  </tr>
              </thead>
              <tbody>
                  {% for item in tn2vepg_data %}
                  <tr>
                      <td>{{ item.date }}</td>
                      <td>{{ item.avg29 }}</td>
                      <td>{{ item.peak29}}</td>
                      <td>{{ item.avg30}}</td>
                      <td>{{ item.peak30}}</td>
                      <td>{{ item.avg1 }}</td>
                      <td>{{ item.peak1 }}</td>
                      <td>{{ item.avg10 }}</td>
                      <td>{{ item.peak10 }}</td>
                      <td>{{ item.avg11 }}</td>
                      <td>{{ item.peak11 }}</td>
                      <td>{{ item.avg12 }}</td>
                      <td>{{ item.peak12 }}</td>
                      <td>{{ item.avg2 }}</td>
                      <td>{{ item.peak2 }}</td>
                      <td>{{ item.avg3 }}</td>
                      <td>{{ item.peak3 }}</td>
                      <td>{{ item.avg4 }}</td>
                      <td>{{ item.peak4 }}</td>
                      <td>{{ item.avg5 }}</td>
                      <td>{{ item.peak5 }}</td>
                      <td>{{ item.avg6 }}</td>
                      <td>{{ item.peak6 }}</td>
                      <td>{{ item.avg7 }}</td>
                      <td>{{ item.peak7 }}</td>
                      <td>{{ item.avg8 }}</td>
                      <td>{{ item.peak8 }}</td>
                      <td>{{ item.avg9 }}</td>
                      <td>{{ item.peak9 }}</td>
                      <td>{{ item.actpdpcont }}</td>
                      <td>{{ item.acteps }}</td>
                      <td>{{ item.actsub }}</td>
                  </tr>
                  {% endfor %}
              </tbody>
          </table>
      </div>

      <div id="sousseepg_table" class="table-section" style="display: none;">
          <table class="table table-bordered table-striped" border="1">
              <thead>
                  <tr>
                      <th>Date</th>
                      <th>Average gc-0/29/1</th>
                      <th>Peak gc-0/29/1</th>
                      <th>Average gc-0/30/1</th>
                      <th>Peak gc-0/30/1</th>
                      <th>Average gc-0/1/1</th>
                      <th>Peak gc-0/1/1</th>
                      <th>Average gc-0/2/1</th>
                      <th>Peak gc-0/2/1</th>
                      <th>Average gc-0/3/1</th>
                      <th>Peak gc-0/3/1</th>
                      <th>Average gc-0/4/1</th>
                      <th>Peak gc-0/4/1</th>
                      <th>Average gc-0/5/1</th>
                      <th>Peak gc-0/5/1</th>
                      <th>Average gc-0/6/1</th>
                      <th>Peak gc-0/6/1</th>
                      <th>Active PDP context</th>
                      <th>Active EPS Bearers</th>
                      <th>Active Subscribers</th>
                  </tr>
              </thead>
              <tbody>
                  {% for item in soepg_data %}
                  <tr>
                      <td>{{ item.date }}</td>
                      <td>{{ item.avg29 }}</td>
                      <td>{{ item.peak29}}</td>
                      <td>{{ item.avg30}}</td>
                      <td>{{ item.peak30}}</td>
                      <td>{{ item.avg1 }}</td>
                      <td>{{ item.peak1 }}</td>
                      <td>{{ item.avg2 }}</td>
                      <td>{{ item.peak2 }}</td>
                      <td>{{ item.avg3 }}</td>
                      <td>{{ item.peak3 }}</td>
                      <td>{{ item.avg4 }}</td>
                      <td>{{ item.peak4 }}</td>
                      <td>{{ item.avg5 }}</td>
                      <td>{{ item.peak5 }}</td>
                      <td>{{ item.avg6 }}</td>
                      <td>{{ item.peak6 }}</td>
                      <td>{{ item.actpdpcont }}</td>
                      <td>{{ item.acteps }}</td>
                      <td>{{ item.actsub }}</td>
                  </tr>
                  {% endfor %}
              </tbody>
          </table>
      </div>
  </div>
</section>

<script>
  $(document).ready(function() {
      $('.table-section').hide();

      $('#tn1epg_table').show();

      $('#epgBtn').click(function(e) {
          e.preventDefault();
          $('.table-section').hide();
          $('#tn1epg_table').show();
      });

      flatpickr("#dateRangePicker", {
          mode: "range",
          dateFormat: "Y-m-d",
      });

      $('#goBtn').click(function(e) {
          e.preventDefault();
          var selectedOption = $('.custom-select').val();
          var dateRange = $('#dateRangePicker').val().split(' to ');

          if (dateRange.length !== 2) {
              alert("Veuillez sÃ©lectionner une plage de dates valide.");
              return;
          }

          var startDate = new Date(dateRange[0]);
          var endDate = new Date(dateRange[1]);

          $('.table-section tbody tr').each(function() {
              var dateText = $(this).find('td:first-child').text().trim();
              var rowDate = new Date(dateText.replace(/\./g, '-'));

              if (rowDate >= startDate && rowDate <= endDate) {
                  $(this).show();
              } else {
                  $(this).hide();
              }
          });

          $('.table-section').hide();
          $('#' + selectedOption.toLowerCase() + '_table').show();
      });

      var months = [];
      var currentDate = new Date();
      var currentMonth = currentDate.getMonth();
      var currentYear = currentDate.getFullYear();

      for (var i = 5; i >= 0; i--) {
          var pastMonth = new Date(currentYear, currentMonth - i, 1);
          months.push(pastMonth.toLocaleString('default', { month: 'long' }));
      }

      var ctx = document.getElementById('myChart').getContext('2d');
      var myChart = new Chart(ctx, {
          type: 'bar',
          data: {
              labels: months,
              datasets: [{
                  label: '',
                  data: [12, 19, 3, 5, 2, 3],
                  backgroundColor: [
                      'rgba(255, 99, 132, 0.2)',
                      'rgba(54, 162, 235, 0.2)',
                      'rgba(255, 206, 86, 0.2)',
                      'rgba(75, 192, 192, 0.2)',
                      'rgba(153, 102, 255, 0.2)',
                      'rgba(255, 159, 64, 0.2)'
                  ],
                  borderColor: [
                      'rgba(255, 99, 132, 1)',
                      'rgba(54, 162, 235, 1)',
                      'rgba(255, 206, 86, 1)',
                      'rgba(75, 192, 192, 1)',
                      'rgba(153, 102, 255, 1)',
                      'rgba(255, 159, 64, 1)'
                  ],
                  borderWidth: 1
              }]
          },
          options: {
              scales: {
                  y: {
                      beginAtZero: true
                  }
              }
          }
      });
  });
</script>
